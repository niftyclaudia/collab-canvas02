{
  "rules": {
    "sessions": {
      "main": {
        "users": {
          ".read": "auth != null",
          "$userId": {
            ".write": "auth != null && auth.uid == $userId",
            "cursor": {
              ".write": "auth != null && (auth.uid == $userId || !data.exists())"
            },
            "presence": {
              ".write": "auth != null && (auth.uid == $userId || !data.exists() || (newData.child('online').val() == false && root.child('sessions/main/users/' + $userId + '/presence/lastSeen').val() < (now - 300000))) || (newData.child('online').val() == false && newData.child('lastSeen').val() > (now - 60000))"
            }
          }
        }
      }
    }
  }
}
